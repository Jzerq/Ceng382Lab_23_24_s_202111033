@page "{id:int}"
@model FitnessChallengeApp.Pages.Challenges.DetailsModel
@{
    ViewData["Title"] = "Challenge Details";
    ViewData["BodyClass"] = "challenges";
}

@if (Model.Challenge != null)
{
    <h1>@Model.Challenge.Title</h1>
    <p>@Model.Challenge.Description</p>
    <p>Category: @Model.Challenge.Category</p>
    <p>Difficulty: @Model.Challenge.DifficultyLevel</p>

    <h2>Rate this Challenge</h2>
    <form method="post" asp-page-handler="Rate" asp-route-id="@Model.Challenge.Id">
        <div class="form-group">
            <label asp-for="Rating.Rating" class="white-text"></label>
            <select asp-for="Rating.Rating" class="form-control dark-dropdown">
                @for (int i = 1; i <= 5; i++)
                {
                    <option value="@i">@i</option>
                }
            </select>
            <span asp-validation-for="Rating.Rating" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Rating.Comment" class="white-text"></label>
            <textarea asp-for="Rating.Comment" class="form-control white-text"></textarea>
            <span asp-validation-for="Rating.Comment" class="text-danger"></span>
        </div>
        <button type="submit" class="btn btn-primary">Submit Rating</button>
    </form>

    <form method="post" asp-page-handler="SaveChallenge" asp-route-id="@Model.Challenge.Id">
        <button type="submit" class="btn btn-secondary mt-3">Save Challenge</button>
    </form>

    <h2>Past Ratings</h2>
    <div>
        @foreach (var rating in Model.Ratings)
        {
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">@rating.Username</h5>
                    <p class="card-text">Rating: @rating.Rating</p>
                    <p class="card-text">@rating.Comment</p>
                </div>
            </div>
        }
    </div>

    <h2>Leaderboard</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Username</th>
                <th>Points</th>
            </tr>
        </thead>
        <tbody>
        @for (int i = 0; i < Model.Leaderboard.Count; i++)
        {
            <tr>
                <td>@(i + 1)</td>
                <td>@Model.Leaderboard[i].Username</td>
                <td>@Model.Leaderboard[i].Points</td>
            </tr>
        }
        </tbody>
    </table>

    <a asp-page="/Challenges/Join" asp-route-id="@Model.Challenge.Id" class="btn btn-success">Join Challenge</a>
    <a asp-page="/Challenges/Leave" asp-route-id="@Model.Challenge.Id" class="btn btn-secondary">Leave Challenge</a>
}
else
{
    <h1>Challenge not found</h1>
    <p>The challenge you are looking for does not exist.</p>
}

<style>
    .challenges {
        background-image: url('/images/challenges-background.png');
        background-size: cover;
        background-attachment: fixed;
    }
    .white-text {
        color: white !important;
    }
    .form-control.white-text {
        background-color: transparent;
        color: white;
    }
    .form-control.white-text::placeholder {
        color: white;
    }
    .dark-dropdown {
        background-color: #333;
        color: white;
    }
    .dark-dropdown option {
        background-color: #333;
        color: white;
    }
</style>
